{% set version = "1.4.15" %}

package:
  name: xapian
  version: {{ version }}

source:
  - url: https://oligarchy.co.uk/xapian/{{ version }}/xapian-core-{{ version }}.tar.xz
    sha256: b168e95918a01e014fb6a6cbce26e535f80da4d4791bfa5a0e0051fcb6f950ea
    folder: xapian-core

  - url: https://oligarchy.co.uk/xapian/{{ version }}/xapian-bindings-{{ version }}.tar.xz
    sha256: 68441612d87904a49066e5707a42cde171e4d423bf8ad23f3f6c04b8a9b2c40c
    folder: xapian-bindings

build:
  number: 1
  skip: true  # [win]

requirements:
  build:
    - {{ compiler('cxx') }}
  host:
    - zlib

outputs:
  - name: xapian-core
    requirements:
      host:
        - zlib
    files:
      - bin/xapian*
      - bin/simpleindex
      - bin/simplesearch
      - bin/copydatabase
      - bin/simpleexpand
      - bin/quest
      - include/xapian/
      - lib/libxapian.so*  # [linux]
      - lib/libxapian.*.dylib  # [osx]
      - lib/libxapian.a
      - lib/cmake/xapian/
      - lib/pkgconfig/xapian-core.pc
      - share/aclocal/xapian.m4
      - share/xapian-core/
    run_exports:
      - {{ pin_subpackage('xapian-core') }}
    test:
      commands:
        - xapian-config --cxxflags --libs

  - name: python-xapian
    requirements:
      host:
        - python {{ python }}
        - zlib
        - sphinx  # required even with --disable-documentation  :-/
      run:
        - python {{ python }}
        - {{ pin_subpackage('xapian-core', exact=True) }}
    files:
      - ${SP_DIR}/xapian/
    test:
      imports:
        - xapian

about:
  home: http://xapian.org
  license: GPL-2.0+
  license_family: GPL
  license_file: COPYING
  summary: C++ Core and Python Bindings for the Xapian Open Source Search Engine Library.
  description: |
    Xapian is an Open Source search engine library which allows developers
    to add advanced indexing and search facilities to their own applications.
    It has built-in support for several families of weighting models and also
    supports a rich set of boolean query operators.
  doc_url: https://xapian.org/docs/
  dev_url: https://xapian.org/bleeding

extra:
  recipe-maintainers:
    - kohr-h
